<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Information | KPI</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <style>
        * { box-sizing: border-box; }

        .join-section {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 40px 20px;
            margin-bottom: 20px;
        }

        .btn-join-kpi {
            background: linear-gradient(135deg, #ff0040, #b71c1c);
            color: white;
            padding: 16px 45px;
            border-radius: 50px;
            font-family: 'Outfit', sans-serif;
            font-weight: 800;
            font-size: 1.1rem;
            border: none;
            cursor: pointer;
            box-shadow: 0 0 25px rgba(255, 0, 64, 0.5);
            transition: 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-join-kpi:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 35px rgba(255, 0, 64, 0.8);
        }
    </style>
    
</head>
<body>
    <video id="bg-video" autoplay muted loop playsinline>
        <source src="https://files.catbox.moe/wuute8.mp4" type="video/mp4">
    </video>

    <audio id="bgMusic" loop>
  <source src="https://files.catbox.moe/ab5fee.mp4" type="audio/mpeg">
    </audio>

    <script>
  const bgMusic = document.getElementById("bgMusic");
  let musicStarted = false;

  function startMusicOnce() {
    if (musicStarted) return;
    bgMusic.volume = 0.5;
    bgMusic.play().then(() => {
      musicStarted = true;
    }).catch(()=>{});
  }

  document.addEventListener("click", startMusicOnce);
  document.addEventListener("touchstart", startMusicOnce);
    </script>
    
    <div class="menu-toggle" onclick="document.querySelector('.sidebar').classList.toggle('active')"><i class="fas fa-bars"></i></div>  
    <aside class="sidebar">
        <div class="brand">KELOMPOK 3</div>
        <ul class="menu-list">
  <li>
    <a href="index.html">
      <i class="fas fa-home"></i> Home
    </a>
  </li>

  <li>
    <a href="members.html">
      <i class="fas fa-users"></i> Anggota
    </a>
  </li>

  <li>
    <a href="announcements.html">
      <i class="fas fa-book"></i> Materi 1
    </a>
  </li>

  <li>
    <a href="materi.html">
      <i class="fas fa-book"></i> Materi 2
    </a>
  </li>

  <li>
    <a href="materi2.html">
      <i class="fas fa-book"></i> Materi 3
    </a>
  </li>

  <li>
    <a href="materi3.html">
      <i class="fas fa-book"></i> Materi 4
    </a>
  </li>

  <li>
    <a href="materi4.html">
      <i class="fas fa-book"></i> Materi 5
    </a>
  </li>

  <li>
    <a href="materi5.html">
      <i class="fas fa-book"></i> Materi 6
    </a>
  </li>
</ul>
       <!-- <div class="sidebar-footer">
           <a href="admin.html" style="color:#555; text-decoration:none; font-size:0.8rem;">Admin Login</a>
        </div>-->
    </aside>
    <main class="main-content">
        <section>
            <div class="section-title" data-aos="fade-right">Inflasi Zimbabwe</div>
            <div id="loading" class="loader-container"><div class="loader"></div></div>
            <div id="announce-container" style="max-width: 800px;"></div>
        </section>

        <div class="join-section" data-aos="zoom-in">
            <button class="btn-join-kpi" onclick="location.href='materi.html'">
                Lihat Penyebab Utama<i class="fas fa-arrow-right"></i>
            </button>
        </div>
        
        <footer><p>&copy; KELOMPOK 3<span>ü§ç</span>.</p></footer>
    </main>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script type="module">
  import { db } from './config.js';
  import { collection, query, where, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // kalo lu pake AOS di file ini
  if (window.AOS) AOS.init({ once: true });

  const page = (location.pathname.split('/').pop() || '').toLowerCase();

  // ‚úÖ MAPPING FINAL SESUAI FILE LU
  const targetMap = {
    "announcements.html": "materi1",
    "materi.html": "materi2",
    "materi2.html": "materi3",
    "materi3.html": "materi4",
    "materi4.html": "materi5",
    "materi5.html": "materi6",
  };

  const target = targetMap[page];

  const container = document.getElementById('announce-container');
  const loading = document.getElementById('loading');

  async function fetchAnnounce() {
    try {
      if (!target) throw new Error("Target halaman ga ketemu untuk: " + page);

      const q = query(
        collection(db, "announcements"),
        where("target", "==", target),
        orderBy("createdAt", "desc")
      );

      const snap = await getDocs(q);

      if (snap.empty) {
        container.innerHTML = "<p>Tidak ada pengumuman.</p>";
        return;
      }

      container.innerHTML = "";
      snap.forEach((doc) => {
        const a = doc.data();
        container.innerHTML += `
          <div class="announce-card" data-aos="fade-left">
            <div class="announce-meta">
              <span class="announce-tag">${a.category ?? ""}</span>
              <span><i class="far fa-calendar-alt"></i> ${a.date ?? ""}</span>
            </div>
            <h3>${a.title ?? ""}</h3>
            <p style="color:var(--text-sec); margin-top:10px">
  ${(a.desc ?? "")
    .trim()
    .replace(/\n{3,}/g, "\n\n")
    .replace(/\n\n/g, "<br><br>")
    .replace(/\n/g, "<br>")}
</p>
          </div>
        `;
      });
    } catch (e) {
      console.error(e);
      container.innerHTML = "<p>Gagal load pengumuman.</p>";
    } finally {
      if (loading) loading.style.display = "none"; // ‚úÖ biar ga muter terus
    }
  }

  fetchAnnounce();
</script>
</body>
</html>
